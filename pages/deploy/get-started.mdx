# How to deploy (current)

## Install the Deploy CLI

First, clone the Wasmer Deploy Repository

```
git clone git@github.com:wasmerio/deploy.git
```

## Register and get a token

Register with [wasmer.io](https://wasmer.io/) if you are not yet registered.
Then, go to https://wasmer.io/settings/access-tokens and generate a new token.

Use that token `wap_xyz` as the value of the `WASMER_TOKEN` environment.

## Create a deployment configuration

```jsonc
// `deployment.json`
{
  // The name of the app
  "name": "ferris",
  "workload": {
    "name": "ferris",
    "runner": {
      "wcgi": {
        "source": {
          "webc": {
            "repository": "https://registry.wapm.dev/",
            "namespace": "christoph",
            "name": "ferris2"
          }
        }
      }
    }
  }
}
```

## Deploy with that config

```console
$ WASMER_TOKEN=TOKEN cargo run -p wasmer-server-cli -- publish-deployment deployment.json
```

# Full configuration

```json
{
  "name": "my-deployment",
  "workload": {
    "name": "my-workload",
    "runner": {
      "webc_command": {
        "package": {
          "repository": "https://wapm.dev/",
          "namespace": "ns",
          "name": "pkg",
          "tag": "0.1.2",
          "auth_token": null
        },
        "command": "some-command"
      }
    },
    "capabilities": {
      "cpu": {
        "maximum_threads": 100,
        "maximum_usage": 2000
      },
      "fs": {
        "volumes": []
      },
      "memory_swap": {
        "swappiness": "never",
        "memory_id": null,
        "maximum_size": 1073741824
      },
      "memory_persistent": null,
      "network": {
        "enabled": true,
        "network_id": null,
        "ingress": {
          "enabled": true,
          "maximum_bandwidth_per_second": 104857600
        },
        "egress": {
          "enabled": false,
          "maximum_bandwidth_per_second": 1048576
        }
      },
      "network_dns": {
        "enabled": true,
        "servers": ["1.1.1.1"],
        "allowed_hosts": {
          "allow_all_hosts": false,
          "hosts": ["hello.com"],
          "regex_patterns": [".*\\.wasmer\\.io"],
          "wildcard_patterns": ["*.wasmer.io"]
        }
      },
      "network_gateway": {
        "enforce_https": true,
        "domains": ["my-site.com"]
      }
    }
  }
}
```
