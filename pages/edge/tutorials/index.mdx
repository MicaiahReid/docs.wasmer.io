import { Steps, Callout, FileTree } from "nextra-theme-docs";
import StaticSite from "@components/deploy/quickstart/StaticSite";
import edgeReactImg from "@assets/deploy/tutorials/edge-react.png";

# Starter guide for deploying a react app

In this guide, you'll learn the process of publishing a static site using react on Wasmer Edge.

## Prerequisites

The project requires the following tools to be installed on your system:

- [Rust](https://www.rust-lang.org/tools/install)

## Deploying a Static Site

<Steps>
### Install the Wasmer App CLI

Install the latest version of `Wasmer CLI` following the instructions [here](/install).

<Callout type="info" emoji="‚ÑπÔ∏è">
  You can see all commands available with `wasmer --help` or click
  [here](/edge/cli/) to see the full documentation.
</Callout>

### Login

Next, you need to authenticate with Wasmer.

- Create a new account or log in at [Wasmer](https://wasmer.io).
- Navigate to [Wasmer.io Settings](https://wasmer.io/settings) and create a new login token

Now you can log in by running the command below and pasting the token:

```shell copy
$ wasmer login <token>
```

To test that everything works correctly, you can run:

```shell copy
$ wasmer whoami
logged into registry "https://registry.wasmer.io/graphql" as user "<user-name>"
```

### Step 3.1: Initialize the React Starter template

<Callout type="info" emoji="‚ÑπÔ∏è">
  If you have already have a react app, you can skip this step and follow the
  step 3.2.
</Callout>

Clone the starter template from GitHub:

```shell copy
$ git clone https://github.com/wasmerio/edge-react-starter.git
```

### Step 3.2: Setup a current react project for Wasmer Edge

Run the commands below to initialize files for Wasmer Edge:

```bash
$ wasmer app create static-site
  Initializing in current directory: (...)/deploy-tutorials/<your-app-name>
  No wasmer.toml found. Initializing package...
  App name (namespace/name): <your-namespace>/<your-app-name>
  Public directory (path to the website files): : public
  Creating public directory at '(...)/deploy-tutorials/<your-app-name>/public'...
  Creating stub index.html...
  Writing wasmer.toml package to '(...)/deploy-tutorials/<your-app-name>/wasmer.toml'
  No app.yaml found. Configuring new app...
  Writing Deploy config: '(...)/deploy-tutorials/<your-app-name>/app.yaml'
  Would you like to publish the new package and app? [y/n]: n
  Done!
```

The `wasmer app create static-site` command will prompt you for the following:

- App name: This is the name of your app. It must be unique across all apps on your namespace.
- **Public directory**: This is the directory that holds the website files. The default is `public`.
- **Publish**: This will publish the new package and app to the registry.

<Callout type="default" emoji="‚öôÔ∏è">
  As you see above in the last line of the output, the CLI will prompt you to
  publish the new package and app. We will do this later, so we enter "n" or
  "no".
</Callout>

The above command will do the following:

- Create a Wasmer package config (`wasmer.toml`)
- Create a app config (`app.yaml`)
- Create a public directory that holds the website data

<Callout type="default" emoji="‚öôÔ∏è">
  As mentioned above, the default public directory is `public`. You **must**
  change this for a react project to `build` or `dist` or any suitable directory
  other than public because it might contain your static assets such as
  **favicon**. The starter project in step 3.1, is setup with vite so the build
  directory is automatically set to `dist`.
  <br /> For a react project you can do this by setting the `outDir` using the `-o`
  flag in the `build` script in `package.json`:
>
  ```json
  "scripts": {
    "build": "vite build -o dist" // üëàüèº dist or any other directory
  }
  ```
</Callout>

After this you would have to change your `wasmer.toml` to match your project's build directory:

```toml copy filename="wasmer.toml"
[package]
name = "<your-wasmer-username>/<your-app-name>"
version = "0.1.0"
description = "Your cool react project's description"

[dependencies]
"sharrattj/static-web-server" = "1"

[fs]
public = "dist" # üëàüèº dist or any other directory
```

### Step 4: Test Your Site Locally

You can now test your site locally by running the following command:

```shell copy
$ wasmer run . --net -- --port 9000
```

This will start a local server using the Static Web Server on `http://localhost:9000` and now you can access your site on the web at the URL provided in the output.

<StaticSite image={edgeReactImg} />

You can also specify a different port by changing the `--port` flag.

> The arguments after `--` are passed to the static web server.

<Callout type="info" emoji="‚ÑπÔ∏è">
  You can see all the available options with `wasmer run --help` or click
  [here](/runtime/cli/) to see the full documentation. To see all the avilable
  options for the static web server, run `wasmer run . -- --help`.
</Callout>

### Step 6: Deploy Your Site

To deploy your site just build your site and run the following command:

```shell copy
$ pnpm run build
```

Run the following command to deploy your site:

```shell copy
$ wasmer deploy
Publishing package...
[1/2] ‚¨ÜÔ∏è   Uploading...
[2/2] üì¶  Publishing...
Successfully published package `<your-wasmer-username>/<your-app-name>@0.1.0`
Waiting for package to become available........
Package '<your-wasmer-username>/<your-app-name>@0.1.0' published successfully!

Deploying app <your-app-name>...

 ‚úÖ App your-app-name was successfully deployed!

> App URL: https://<your-app-name>.wasmer.app
> Versioned URL: https://exj0iotefyy5.id.wasmer.app
> Admin dashboard: https://wasmer.io/apps/<your-wasmer-username>/<your-app-name>
```

> You can checkout our versioned URL above to access how our starter demo looks like.

<Callout type="info" emoji="‚ÑπÔ∏è">
  You must be in the directory holding the `wasmer.toml` and `app.yaml` config
  files.
</Callout>

<Callout type="info" emoji="‚ÑπÔ∏è">
  `wasmer deploy` automatically publishes your package and bumps the minor
  version. You can check all the available options with `wasmer deploy --help`
  or click [here](/edge/cli) to see the full documentation.
</Callout>

Executing this command will package and deploy your site.

Now you can access your site on the web at the URL provided in the output.

<Callout type="default" emoji="‚ô∫">
  To make changes to your site, simply modify the files in the public directory
  and run `wasmer deploy` again to deploy the changes.
</Callout>

<StaticSite image={edgeReactImg} />

</Steps>

## Conclusion

Congratulations! You have successfully deployed your react project on wasmer edge .
